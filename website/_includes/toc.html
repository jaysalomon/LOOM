{% capture tocWorkspace %}
    {% comment %}
        Generate table of contents from markdown headers
        Based on: https://github.com/allejo/jekyll-toc
    {% endcomment %}

    {% capture my_toc %}{% endcapture %}
    {% assign minHeader = 2 %}
    {% assign maxHeader = 6 %}
    {% assign nodes = include.html | split: '<h' %}
    {% assign firstHeader = true %}

    {% capture listModifier %}{% if include.ordered %}1.{% else %}-{% endif %}{% endcapture %}

    {% for node in nodes %}
        {% if node == "" %}
            {% continue %}
        {% endif %}

        {% assign headerLevel = node | replace: '"', '' | slice: 0, 1 | times: 1 %}

        {% if headerLevel < minHeader or headerLevel > maxHeader %}
            {% continue %}
        {% endif %}

        {% assign _idWorkspace = node | split: 'id="' %}
        {% assign _idWorkspace = _idWorkspace[1] | split: '"' %}
        {% assign htmlID = _idWorkspace[0] %}

        {% assign _classWorkspace = node | split: 'class="' %}
        {% assign _classWorkspace = _classWorkspace[1] | split: '"' %}
        {% assign htmlClass = _classWorkspace[0] %}

        {% if htmlClass contains "no-toc" %}
            {% continue %}
        {% endif %}

        {% capture _hAttrToStrip %}{{ node | split: '>' | first }}>{% endcapture %}
        {% assign header = node | remove: _hAttrToStrip %}
        {% assign header = header | remove: '</h' %}
        {% assign header = header | remove: headerLevel %}
        {% assign header = header | remove: '>' %}

        {% assign space = '' %}
        {% for i in (1..headerLevel) %}
            {% assign space = space | prepend: '    ' %}
        {% endfor %}

        {% capture my_toc %}{{ my_toc }}
{{ space }}{{ listModifier }} [{{ header | strip_html }}](#{{ htmlID }}){% endcapture %}
    {% endfor %}

    {% if include.class %}
        {% capture my_toc %}<nav class="{{ include.class }}">{{ my_toc | markdownify | strip }}</nav>{% endcapture %}
    {% else %}
        {% capture my_toc %}<nav>{{ my_toc | markdownify | strip }}</nav>{% endcapture %}
    {% endif %}
{% endcapture %}{% assign tocWorkspace = '' %}{{ my_toc }}